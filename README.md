# 🌌 Cosmic Liquid Painter - SPECTACULAR EDITION ✨

<div align="center">

![Version](https://img.shields.io/badge/version-2.0.0-gold.svg)
![Three.js](https://img.shields.io/badge/Three.js-r128-green.svg)
![WebGL](https://img.shields.io/badge/WebGL-2.0-blue.svg)
![GPU Particles](https://img.shields.io/badge/Particles-10%2C000%2B-ff00ff.svg)
![Physics](https://img.shields.io/badge/Physics-Quantum%20%26%20Relativistic-cyan.svg)

### 🎨 **Create Mind-Blowing Cosmic Art with Advanced Physics Simulation**

Experience the ultimate 3D physics art game where liquid streams dance through space, gravity bends reality, and quantum mechanics creates impossible beauty!

[**🎮 PLAY NOW**](https://yourusername.github.io/cosmic-liquid-painter) | [**📺 Watch Demo**](#) | [**🎯 Features**](#-spectacular-features)

</div>

---

## 🚀 **SPECTACULAR FEATURES**

### 🌈 **GPU-Accelerated Particle System**
- **10,000+ simultaneous particles** rendered at 60 FPS
- Custom WebGL shaders with quantum fluctuation effects
- Real-time physics calculations on the GPU
- Dynamic LOD system for optimal performance

### ⚛️ **Advanced Physics Simulation**
- **Quantum Mechanics**: Heisenberg uncertainty, wave-particle duality, quantum tunneling, entanglement
- **Relativistic Effects**: Time dilation, length contraction, gravitational lensing, Doppler shift
- **Electromagnetic Fields**: Lorentz force, magnetic field interactions, aurora effects
- **N-Body Gravitation**: Realistic orbital mechanics with multiple gravity wells

### 🎆 **8 Exotic Liquid Types**
1. **⚡ Plasma Stream** - Turbulent, high-energy particles with electric arcs
2. **💎 Crystal Liquid** - Solidifying particles that form crystalline structures
3. **⏰ Temporal Flux** - Time-distorted particles with pulsing effects
4. **☢️ Anti-Matter** - Gravity-repelling particles with inverse properties
5. **🌀 Quantum Foam** - Probabilistic particles with superposition states
6. **🌑 Dark Matter** - Heavy, invisible particles (5x mass)
7. **✨ Exotic Matter** - NEGATIVE MASS particles that defy physics
8. **💡 Photonic Stream** - Light-speed particles with zero mass

### 🕳️ **Advanced Gravity Wells**
- **⭐ Stars** - Steady gravitational pull with fusion effects
- **🪐 Planets** - Moderate gravity with atmospheric effects
- **🕳️ Black Holes** - Event horizons with gravitational lensing
- **💫 Neutron Stars** - Extreme magnetic fields with aurora generation
- **🌀 Binary Systems** - Orbiting gravity wells with Lagrange points
- **🔮 Wormholes** - Spacetime tunnels (coming soon!)

### 🎯 **Cinematic Visual Effects**
- **HDR Bloom** with ACES tonemapping
- **Volumetric Lighting** with god rays
- **Chromatic Aberration** for lens distortion
- **Film Grain** for cinematic texture
- **Vignette** for dramatic framing
- **Multi-layer Particle Glow** with 4 rendering passes

### 🎮 **Holographic UI System**
- **Animated Holographic Panels** with quantum fluctuation
- **Neon Text Effects** with pulsing animations
- **Energy Wave Buttons** with particle explosions
- **Floating Ambient Particles** in the interface
- **Achievement Fireworks** with procedural sound
- **Cosmic Loading Animation** with rotating rings

### 🔊 **Procedural Audio System**
- **Web Audio API** synthesized sound effects
- **Dynamic Soundscapes** based on particle interactions
- **Achievement Fanfares** with harmonic chords
- **Launch Sounds** with frequency modulation
- **Explosion Effects** with filtered white noise

---

## 🎮 **CONTROLS**

| Action | Control | Effect |
|--------|---------|--------|
| **Launch Liquid** | Click & Drag | Create spectacular particle streams |
| **Quick Burst** | Single Click | Explosive omnidirectional burst |
| **Place Gravity Well** | Right Click | Add stars, planets, or black holes |
| **Camera Control** | Mouse Drag | Rotate view around galaxy |
| **Zoom** | Mouse Wheel | Zoom in/out of the action |
| **Adjust Power** | Shift + Wheel | Fine-tune launch velocity |
| **Pause Time** | Space | Freeze the universe |
| **Switch Liquid** | 1-8 Keys | Select exotic liquid types |
| **Clear Canvas** | Ctrl/Cmd + C | Reset the cosmic canvas |
| **Toggle Effects** | Click Button | Enable/disable visual effects |

---

## 🏆 **ACHIEVEMENTS**

Unlock spectacular achievements as you master the cosmos:

- 🎨 **Cosmic Artist** - Create your first particle stream
- 🌌 **Galaxy Architect** - Place 10 gravity wells
- 🪐 **Orbital Master** - Achieve 5 stable orbits
- ⚡ **Plasma Lord** - Launch 1000 plasma particles
- 🕳️ **Event Horizon** - Feed 100 particles to a black hole
- 🌀 **Quantum Entangler** - Create entangled particle pairs
- 💫 **Relativistic Speed** - Accelerate particles near light speed
- 🏅 **Universe Creator** - Reach 10,000 active particles

---

## 💻 **TECHNICAL SPECIFICATIONS**

### **Performance**
- **Particles**: 10,000+ simultaneous (GPU)
- **Frame Rate**: 60 FPS on modern hardware
- **Physics**: 120 Hz update rate
- **Rendering**: WebGL 2.0 with custom shaders

### **Browser Requirements**
- Chrome 90+ / Firefox 88+ / Safari 14+ / Edge 90+
- WebGL 2.0 support
- Web Audio API support
- 4GB+ RAM recommended
- Dedicated GPU recommended for best experience

### **Technologies Used**
- **Three.js r128** - 3D rendering engine
- **WebGL 2.0** - GPU acceleration
- **Custom GLSL Shaders** - Visual effects
- **Web Audio API** - Procedural sound
- **ES6 Modules** - Clean architecture

---

## 🛠️ **INSTALLATION**

### **Quick Start**
```bash
# Clone the repository
git clone https://github.com/yourusername/cosmic-liquid-painter.git

# Navigate to project
cd cosmic-liquid-painter

# Open in browser
open index.html
# OR start a local server
python3 -m http.server 8080
```

### **Development Setup**
```bash
# Install dependencies (optional, for development)
npm install

# Start development server
npm run dev

# Build for production
npm run build

# Deploy to GitHub Pages
npm run deploy
```

---

## 🎯 **GAMEPLAY TIPS**

### **Creating Spectacular Effects**

1. **🌊 Liquid Fountains**: Click and drag upward near a gravity well
2. **🌀 Spiral Galaxies**: Launch particles tangentially to create spirals
3. **💫 Binary Orbits**: Place two gravity wells close together
4. **🎆 Fireworks**: Use antimatter near regular matter
5. **🌈 Rainbow Streams**: Rapidly switch liquid types while launching
6. **⚡ Lightning Storms**: Use plasma near magnetic fields
7. **🕳️ Accretion Disks**: Launch particles near black holes

### **Advanced Techniques**

- **Quantum Entanglement**: Launch quantum foam to create paired particles
- **Time Dilation**: Place particles near black holes to slow time
- **Gravitational Slingshot**: Use gravity wells to accelerate particles
- **Magnetic Confinement**: Use neutron stars to trap charged particles
- **Exotic Propulsion**: Combine exotic matter with regular matter

---

## 🎨 **SCREENSHOTS**

<div align="center">

### Binary Star System with Plasma Streams
![Binary Stars](https://via.placeholder.com/800x400/000033/00ffff?text=Binary+Star+System)

### Black Hole with Accretion Disk
![Black Hole](https://via.placeholder.com/800x400/000011/ff00ff?text=Black+Hole+Accretion)

### Quantum Entanglement Network
![Quantum Network](https://via.placeholder.com/800x400/001122/00ff00?text=Quantum+Entanglement)

</div>

---

## 🚀 **ROADMAP**

### **Version 2.1** (Coming Soon)
- [ ] Wormhole implementation with teleportation
- [ ] Multiplayer galaxy sharing
- [ ] VR/AR support for immersive experience
- [ ] Mobile touch controls optimization
- [ ] Save/Load artwork feature
- [ ] Video recording and export

### **Version 3.0** (Future)
- [ ] Fluid dynamics simulation
- [ ] Gravitational waves visualization
- [ ] Custom shader editor
- [ ] Procedural galaxy generation
- [ ] Music visualization mode
- [ ] AI-assisted art creation

---

## 👥 **CONTRIBUTING**

We welcome contributions! See [CONTRIBUTING.md](CONTRIBUTING.md) for guidelines.

### **How to Contribute**
1. Fork the repository
2. Create a feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit your changes (`git commit -m 'Add AmazingFeature'`)
4. Push to the branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

---

## 📜 **LICENSE**

This project is licensed under the MIT License - see [LICENSE](LICENSE) for details.

---

## 🙏 **ACKNOWLEDGMENTS**

- **Three.js** team for the amazing 3D library
- **WebGL** community for shader inspiration
- **NASA** for space imagery reference
- **Physics** researchers for quantum mechanics insights
- **You** for exploring the cosmos with us!

---

<div align="center">

### 🌟 **Star this repo if you enjoy creating cosmic art!** 🌟

**Made with ❤️ and physics by the Liquid Galaxy Team**

[**🎮 PLAY NOW**](https://yourusername.github.io/cosmic-liquid-painter) | [**🐛 Report Bug**](https://github.com/yourusername/cosmic-liquid-painter/issues) | [**💡 Request Feature**](https://github.com/yourusername/cosmic-liquid-painter/discussions)

</div>

---

## 🧪 Troubleshooting: Particles Look Like Tiny Dots / Not “Liquid” Enough

If only a small portion of the stream appears or particles render as faint points:

1. Per‑particle size attribute mismatch (fixed): the attribute is now named `aSize` in geometry and used by all custom shaders. If you add your own shader, include `attribute float aSize;` and scale `gl_PointSize` with it.
2. Base size was not being propagated: each particle now stores a `baseSize` on spawn so dynamic modulation doesn’t collapse sizes to the default 2.0.
3. Minimum size clamp: shaders clamp to a small minimum so distant particles do not vanish when perspective divides size away.
4. Additive blending & bloom: ensure post‑processing bloom is active; without it fluid appears like sparse stars. Adjust bloom strength (see `RenderEngine.setupPostProcessing`).
5. Camera distance / fog: fog starts at 500; if particles form near camera < 80 units you may see harsh size falloff. Tweak fog or camera start distance if experimenting.

### Quick Tweaks for a Thicker Fluid Look
Edit `VisualEffects.js` inside each material vertex shader block:
```
gl_PointSize = particleSize * size * (400.0 / -mvPosition.z);
```
Increase 300→400–600 for denser blobs. Or multiply by `(1.0 + vIntensity * 0.5)` for velocity emphasis.

### Screen‑Space Fluid Smoothing (Next Step)
Classic pipeline (from NVIDIA / SPH papers):
1. Render particles as large soft spheres (Gaussian splats) to a floating point depth/thickness buffer.
2. Blur the buffer horizontally + vertically (or bilateral blur with depth preservation).
3. Reconstruct normals from the smoothed depth.
4. Shade a fullscreen quad using Fresnel + environment tint.

We currently only render emissive point sprites. To implement smoothing:
```
// Pseudo steps
1. Create an offscreen WebGLRenderTarget (RGBA + depth or thickness FBO)
2. Render particle Points with depth write ON, additive OFF (alpha blend) using sphere impostor shader outputting linear depth & thickness
3. Apply separable blur passes
4. Reconstruct surface normals in a post shader
5. Composite over scene with additive glow
```

### Attribute Recap
| Attribute           | Purpose                             | Source File         |
| ------------------- | ----------------------------------- | ------------------- |
| position            | Particle position                   | `ParticleSystem.js` |
| color / customColor | Per‑particle base + modulated color | `ParticleSystem.js` |
| aSize               | Per‑particle point size (dynamic)   | `ParticleSystem.js` |

If you see warnings like “attribute aSize not found”, ensure the material is a custom `ShaderMaterial`; standard `PointsMaterial` ignores custom attributes.

### Future Enhancements Suggested
* GPU transform feedback or compute (WebGPU) for >100k particles
* Depth-sorted soft additive blending (weighted blended OIT) for thicker volume
* Curl-noise based velocity field injection for turbulent plasma
* Screen-space thickness based refraction pass

### NEW: Soft Overlay Smoothing Layer (Hybrid Approximation)
An additional optional overlay pass now draws enlarged Gaussian splats over the primary particles.
Purpose: visually fuse nearby particles before a full screen-space fluid solution exists.

Toggle at runtime (console):
```
// Enable
window.cosmoLiquid.renderEngine.toggleFluidSmoothing(true);
// Disable
window.cosmoLiquid.renderEngine.toggleFluidSmoothing(false);
// Toggle
window.cosmoLiquid.renderEngine.toggleFluidSmoothing();
```

Quality scaling (see `VisualEffects.setQualityLevel`):
| Quality | Overlay Scale | Overlay Intensity |
| ------- | ------------- | ----------------- |
| high    | 1.9           | 0.60              |
| medium  | 1.6           | 0.50              |
| low     | 1.3           | 0.40              |

Adjust quickly:
```
// Make overlay blobs softer & larger
const mat = window.cosmoLiquid.renderEngine.visualEffects.getSoftOverlayMaterial();
mat.uniforms.globalScale.value = 2.3;
mat.uniforms.falloff.value = 1.1; // smaller = broader glow
mat.uniforms.intensity.value = 0.7;
```

### Density & Pressure Driven Sizing
Particle sizes now scale with local SPH density & pressure to visually merge where fluid compresses:
Formula (conceptual):
```
sizeMultiplier *= (0.75 + pow(clamp(density/1000,0.2,2.5), 0.6) * 0.9);
sizeMultiplier *= (1.0 + (clampedPressure / 4000.0) * 0.15);
```
This yields thicker clusters without exploding single particles.

Tuning entry point: `updateSingleParticleVisuals` in `ParticleSystem.js`.

If particles look too “blobby”, reduce either:
```
pow(densityNorm, 0.6) -> 0.5
or overlay globalScale -> 1.5
```

If still too granular, raise minimum clamp:
```
const targetSize = Math.max(1.5, baseSize * multiplier); // increase 1.5 -> 2.0
```

---

### Unified Basic Liquid Shader & Visibility Debugging
Less visible liquids (quantum, photonic, antimatter, exotic, darkmatter) now use a shared custom ShaderMaterial instead of `PointsMaterial`, enabling:
* Per-particle `aSize` scaling
* Minimum on-screen size clamp
* Brightness boost uniform (`brightness`)

Adjust at runtime:
```
// Increase global brightness for basic liquids
for (const [k,m] of window.cosmoLiquid.renderEngine.visualEffects.liquidMaterials) {
	if (m.uniforms && m.uniforms.brightness) m.uniforms.brightness.value = 1.6;
}

// Increase minimum base size by tweaking globalSize
for (const [k,m] of window.cosmoLiquid.renderEngine.visualEffects.liquidMaterials) {
	if (m.uniforms && m.uniforms.globalSize) m.uniforms.globalSize.value = 4.8;
}
```

Visibility diagnostics:
```
// Log active particle count & size distribution
window.cosmoLiquid.particleSystem.debugVisibilityStats();
```

If `minSize` < 1.5 frequently, raise clamp in `createBasicLiquidMaterial` vertex shader `max(baseSize, 2.2)` -> `2.8`.

---

### Horizon Click Fallback & Close-Up Visibility
Issue: Previously clicks near the visual horizon (ray almost parallel to z=0 plane) produced `screenToWorld: Cannot calculate world position along horizon` and aborted the current stream.

Fixes Implemented:
1. `RenderEngine.screenToWorld` now detects near-zero ray.z and projects a safe fixed-distance point (300 units forward) instead of returning undefined.
2. Streaming logic (in `main.js`) retains the last valid world emission point if a new screen position can’t be resolved, preventing abrupt cancellation.
3. All liquid shaders gained a `minPointSize` uniform clamping `gl_PointSize` so particles remain visible when the camera is very close (no more vanishing tiny discs during zoom-in).

Runtime Diagnostics:
```
// Camera & particle size range
window.cosmoLiquid.renderEngine.logVisibilityDiagnostics();
// Particle size distribution (existing)
window.cosmoLiquid.particleSystem.debugVisibilityStats();
```

Tuning Examples:
```
// Increase minimum point size globally for basic liquids
for (const [k,m] of window.cosmoLiquid.renderEngine.visualEffects.liquidMaterials) {
	if (m.uniforms && m.uniforms.minPointSize) m.uniforms.minPointSize.value = 9.0;
}

// Adjust fallback horizon distance (edit source): RenderEngine.screenToWorld -> fallbackDist
```

If you still experience streams stopping: ensure `_lastValidStreamWorldPos` is updating (inspect with devtools) and verify no exceptions in console.

---

### 3D Celestial Placement Depth Control
Previously gravity wells / celestial bodies were effectively constrained to a single interaction plane (legacy z=0 projection). You can now position bodies at varying depths.

Controls:
| Key       | Mode           | Effect                                                                                          |
| --------- | -------------- | ----------------------------------------------------------------------------------------------- |
| `P`       | toggle         | Switch between `cameraDistance` (fixed ray distance) and `planeZ` (project to constant Z) modes |
| `[` / `]` | cameraDistance | Decrease / increase placement distance along the camera ray (±25 units)                         |
| `[` / `]` | planeZ         | Move target Z plane down / up by 25 units                                                       |

Runtime State Object:
```
window.cosmoLiquid.celestialPlacement // { mode: 'cameraDistance'|'planeZ', distance: Number, planeZ: Number }
```

Examples:
```js
// Place far away bodies
cosmoLiquid.celestialPlacement.mode = 'cameraDistance';
cosmoLiquid.celestialPlacement.distance = 1200;

// Switch to fixed galactic layer at Z=800
cosmoLiquid.celestialPlacement.mode = 'planeZ';
cosmoLiquid.celestialPlacement.planeZ = 800;
```

API Change:
`RenderEngine.screenToWorld(screenPos, { depthMode, distance, planeZ })`

Depth Modes:
* `planeZ` (default legacy) – intersect ray with plane at `planeZ`.
* `cameraDistance` – ray * normalized * distance from camera.
* (Internally prepared) `customPlane` alias via `planeZ`.

Horizon Fallback:
When the pick ray is nearly parallel to the plane, the method gracefully falls back to a fixed distance (same code path as `cameraDistance`) to avoid undefined results.

Tips:
* Use `cameraDistance` when composing layered systems quickly.
* Use `planeZ` for structured “slices” (e.g., planetary belts, stacked orbital planes).
* Large distances (>5000) are clamped for safety.

---

### Experimental: Screen‑Space Fluid Surface Pass (Prototype)
An optional post effect now approximates a continuous fluid sheet by accumulating particle thickness in a low‑resolution buffer, blurring it, then compositing a glowing surface.

Status: Prototype (no normal reconstruction / refraction yet). Adds a subtle cohesive sheen over dense particle regions.

Enable at runtime (console):
```
// Turn on prototype fluid surface (after engine init)
window.cosmoLiquid.renderEngine.toggleScreenSpaceFluid(true);

// Toggle
window.cosmoLiquid.renderEngine.toggleScreenSpaceFluid();

// Turn off
window.cosmoLiquid.renderEngine.toggleScreenSpaceFluid(false);
```

Quality scaling hooks (will auto‑map later). For now internal presets:
| Level  | Internal Resolution | Blur Radius |
| ------ | ------------------- | ----------- |
| high   | 75% of screen       | 5           |
| medium | 50% (default)       | 4           |
| low    | 33%                 | 3           |

Adjustment (advanced):
```
const ssf = window.cosmoLiquid.renderEngine.screenSpaceFluid;
ssf.setQuality('high');      // switch preset
ssf.blurRadius = 6;          // manual kernel size
ssf.maxThickness = 4.0;      // clamp per‑splat contribution
ssf.globalPointScale = 1.6;  // enlarge impostor spheres
```

Performance Notes:
* Runs after bloom; additive blend only (no depth aware shading yet)
* Cost roughly: 1 particle thickness pass + 2 fullscreen blurs + 1 composite
* Use `setQuality('low')` on integrated GPUs / mobile
* Disable if FPS drops below your target

Roadmap for this pass:
1. Add depth capture & normal reconstruction for proper lighting
2. Bilateral blur to preserve thin sheets
3. Weighted blended OIT integration instead of simple additive
4. Refraction & chromatic dispersion on bright plasma
5. Temporal smoothing to reduce flicker

File reference: `js/core/ScreenSpaceFluid.js`

---
